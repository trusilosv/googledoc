(()=>{"use strict";function e(e){let t=new XMLHttpRequest,r=!1,n=new Promise(((n,s)=>{if(t.open(e.method,e.url,!0),t.addEventListener("load",(()=>{var e,o;if(!r)if(t.status<400)n(t.responseText);else{let r=t.responseText;r&&/html/.test(t.getResponseHeader("content-type"))&&(e=r,(o=document.createElement("div")).innerHTML=e,r=o.textContent.replace(/\n[^]*|\s+$/g,""));let n=new Error("Request failed: "+t.statusText+(r?"\n\n"+r:""));n.status=t.status,s(n)}})),t.addEventListener("error",(()=>{r||s(new Error("Network error"))})),e.headers)for(let r in e.headers)t.setRequestHeader(r,e.headers[r]);t.send(e.body||null)}));return n.abort=()=>{r||(t.abort(),r=!0)},n}const t=document.querySelector("#select_users");function r(){("/collab-backend/users/",e({url:"/collab-backend/users/",method:"GET"})).then((e=>function(e){t.innerHTML="",e.forEach((e=>{let r=document.createElement("option");r.text=e.name,r.value=e.id,t.add(r)}));let r=document.createElement("option");r.text="create user",r.value="new",t.add(r);const n=JSON.parse(sessionStorage.getItem("userId"));t.value=n?JSON.parse(sessionStorage.getItem("userId")):1}(JSON.parse(e))),(e=>report.failure(e)))}t.addEventListener("change",(function(){"new"==t.value&&function(){let t=prompt("Name the new User","");const r=JSON.stringify({name:t});var n;t&&(n=r,e({url:"/collab-backend/users",method:"POST",body:n,headers:{"Content-Type":"application/json"}})).then((e=>{sessionStorage.setItem("userId",JSON.parse(e).id)}),(e=>report.failure(e)))}(),sessionStorage.setItem("userId",t.value),r()})),r()})();